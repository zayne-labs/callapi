---
title: Request & Response Helpers
description: Content type handling, response conversion, and request body processing
---

## Automatic Content-Type Detection

The `Content-Type` header is automatically set based on the request body.

Data types eligible for this automatic setting include:

- Object literals → `application/json`
- Query Strings → `application/x-www-form-urlencoded`
- FormData → `multipart/form-data` (handled by the browser)

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

// application/json
await callApi("https://api.example.com/data", {
	method: "POST",
	body: { name: "John", age: 30 },
});

// application/x-www-form-urlencoded
await callApi("https://api.example.com/form", {
	method: "POST",
	body: "name=John&age=30",
});

// The browser will handle the Content-Type automatically (multipart/form-data)
await callApi("https://api.example.com/upload", {
	method: "POST",
	body: formData,
});
```

Override the default content type if the need arises:

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

await callApi("https://api.example.com/custom", {
	method: "POST",
	body: data,
	headers: {
		"Content-Type": "application/custom+json",
	},
});
```

## Smart Response Parser

CallApi features a smart response parser that automatically detects the appropriate response type based on the `Content-Type` header, eliminating the need to manually specify `responseType` in most cases.

<Callout type="info">
	The automatic detection only occurs when you don't explicitly set a `responseType`. If you provide a
	`responseType`, it will always be used regardless of the `Content-Type` header.
</Callout>

### Automatic Response Type Detection

When no `responseType` is specified, CallApi automatically determines how to parse the response by examining the `Content-Type` header:

**JSON Detection:**

- Matches `application/json` and JSON variants like `application/vnd.api+json`, `application/ld+json`
- Uses regex pattern: `/^application\/(?:[\w!#$%&*.^`~-]\*\+)?json(;.+)?$/i`

**Text Detection:**

- Any content type starting with `text/` (e.g., `text/plain`, `text/html`, `text/css`)
- Specific types: `image/svg+xml`, `application/xml`, `application/xhtml+xml`, `application/html`

**Binary Detection (Blob):**

- Everything else (images, PDFs, videos, unknown types)
- Fallback when no `Content-Type` header is present

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

// Automatically parsed as JSON (Content-Type: application/json)
const { data: user } = await callApi("https://api.example.com/user");

// Automatically parsed as text (Content-Type: text/html)
const { data: html } = await callApi("https://api.example.com/page");

// Automatically parsed as blob (Content-Type: image/png)
const { data: image } = await callApi("https://api.example.com/avatar.png");
```

### Manual Response Type Override

You can still manually specify the response type when needed:

Available response types include:

- All [response types](https://developer.mozilla.org/en-US/docs/Web/API/Response#instance_methods) from the Fetch API:
   - `json()` (default fallback)
   - `text()`
   - `blob()`
   - `arrayBuffer()`
   - `formData()`
- `stream` - Returns the direct [`ReadableStream`](https://developer.mozilla.org/en-US/docs/Web/API/Response/body)

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

// Force specific response types when needed
const { data: imageBlob } = await callApi("https://api.example.com/image", {
	responseType: "blob", // Override automatic detection
});

const { data: rawText } = await callApi("https://api.example.com/data.json", {
	responseType: "text", // Get JSON as raw text instead of parsed object
});

const { data: buffer } = await callApi("https://api.example.com/binary", {
	responseType: "arrayBuffer", // Get as ArrayBuffer for binary processing
});

// Stream large responses
const { data: stream } = await callApi("https://api.example.com/large-file", {
	responseType: "stream", // Get ReadableStream for progressive processing
});
```

**Benefits over Fetch:**

```ts
// With CallApi - automatic detection
const { data } = await callApi("https://api.example.com/user");

// With Fetch - manual parsing required
const response = await fetch("https://api.example.com/user");
const data = await response.json(); // You must know/guess the response type
```

Suppose you want to parse a response with a custom function other than the default `JSON.parse`. In that case, you can pass a custom parser function to the `responseParser` option:

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

const { data, error } = await callApi("https://api.example.com/data", {
	responseParser: (responseString) => customParser(responseString),
});
```

## Custom Request Bodies

CallApi naturally supports all request body types that Fetch does, with a few additional conveniences:

**Object literals**

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";

const result = await callApi("https://api.example.com/user", {
	method: "POST",
	body: { name: "John", age: 30 },
});

// Doing this in Fetch would imply:
const response = await fetch("https://api.example.com/user", {
	method: "POST",
	headers: { "Content-Type": "application/json" },
	body: JSON.stringify({ name: "John", age: 30 }),
});
```

You could also provide a custom serializer/stringifier, other than the default `JSON.stringify`, for objects passed to the request body via the `bodySerializer` option.

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";
const result = await callApi("https://api.example.com/data", {
	method: "POST",
	body: { name: "John", age: 30 },
	bodySerializer: (body) => serialize(body),
});
```

**Query Strings**

Fetch supports [query strings](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams) as a request body out of the box. However this usually requires manual setting with `new URLSearchParams()` and `set()` or `append()`.

CallApi provides the `toQueryString` utility that converts objects to URL-encoded strings:

```ts title="api.ts"
import { callApi } from "@zayne-labs/callapi";
import { toQueryString } from "@zayne-labs/callapi/utils";

const result = await callApi("https://api.example.com/search", {
	method: "POST",
	body: toQueryString({ name: "John", age: 30 }),
});

// The above request is equivalent to this
fetch("https://api.example.com/search", {
	method: "POST",
	headers: { "Content-Type": "application/x-www-form-urlencoded" },
	body: "name=John&age=30",
});
```
